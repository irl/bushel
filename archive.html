
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>Directory Archive &#8212; bushel 0.0.0a documentation</title>
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/graphviz.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/language_data.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Bandwidth Scanner" href="bandwidth.html" />
    <link rel="prev" title="Welcome to bushel’s documentation!" href="index.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="module-bushel.archive">
<span id="directory-archive"></span><h1>Directory Archive<a class="headerlink" href="#module-bushel.archive" title="Permalink to this headline">¶</a></h1>
<p>Persistent filesystem-backed archive for Tor directory protocol
descriptors. This is intended to be used as part of an <a class="reference external" href="https://docs.python.org/3/library/asyncio.html#module-asyncio" title="(in Python v3.7)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">asyncio</span></code></a>
application. File I/O operations are provided by coroutines and coroutine
methods, with the actual I/O performed in an executor.</p>
<dl class="class">
<dt id="bushel.archive.CollectorOutBridgeDescsMarker">
<em class="property">class </em><code class="descclassname">bushel.archive.</code><code class="descname">CollectorOutBridgeDescsMarker</code><a class="reference internal" href="_modules/bushel/archive.html#CollectorOutBridgeDescsMarker"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#bushel.archive.CollectorOutBridgeDescsMarker" title="Permalink to this definition">¶</a></dt>
<dd><p>Enumeration of marker names under the “bridge-descriptors” directory as
specified in §5.2 of <a class="reference internal" href="references.html#collector-protocol" id="id1"><span>[collector-protocol]</span></a>.</p>
<table class="docutils align-center">
<colgroup>
<col style="width: 38%" />
<col style="width: 62%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>EXTRA_INFO</p></td>
<td><p>Bridge extra-info descriptors (§5.2.1)</p></td>
</tr>
<tr class="row-odd"><td><p>SERVER_DESCRIPTOR</p></td>
<td><p>Bridge server descriptors (§5.2.1)</p></td>
</tr>
<tr class="row-even"><td><p>STATUS</p></td>
<td><p>Bridge statuses (§5.2.2)</p></td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="class">
<dt id="bushel.archive.CollectorOutRelayDescsMarker">
<em class="property">class </em><code class="descclassname">bushel.archive.</code><code class="descname">CollectorOutRelayDescsMarker</code><a class="reference internal" href="_modules/bushel/archive.html#CollectorOutRelayDescsMarker"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#bushel.archive.CollectorOutRelayDescsMarker" title="Permalink to this definition">¶</a></dt>
<dd><p>Enumeration of marker names under the “relay-descriptors” directory as
specified in §5.3 of <a class="reference internal" href="references.html#collector-protocol" id="id2"><span>[collector-protocol]</span></a>.</p>
<table class="docutils align-center">
<colgroup>
<col style="width: 38%" />
<col style="width: 62%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>CONSENSUS</p></td>
<td><p>Network status consensuses (§5.3.2)</p></td>
</tr>
<tr class="row-odd"><td><p>EXTRA_INFO</p></td>
<td><p>Relay extra-info descriptors (§5.3.2)</p></td>
</tr>
<tr class="row-even"><td><p>SERVER_DESCRIPTOR</p></td>
<td><p>Relay server descriptors (§5.3.2)</p></td>
</tr>
<tr class="row-odd"><td><p>VOTE</p></td>
<td><p>Network status votes (§5.3.2)</p></td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="class">
<dt id="bushel.archive.CollectorOutSubdirectory">
<em class="property">class </em><code class="descclassname">bushel.archive.</code><code class="descname">CollectorOutSubdirectory</code><a class="reference internal" href="_modules/bushel/archive.html#CollectorOutSubdirectory"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#bushel.archive.CollectorOutSubdirectory" title="Permalink to this definition">¶</a></dt>
<dd><p>Enumeration of subdirectory names under the “out” directory as specified in
§5.0 of <a class="reference internal" href="references.html#collector-protocol" id="id3"><span>[collector-protocol]</span></a>.</p>
<table class="docutils align-center">
<colgroup>
<col style="width: 44%" />
<col style="width: 56%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>BRIDGE_DESCRIPTORS</p></td>
<td><p>Bridge descriptors (§5.2)</p></td>
</tr>
<tr class="row-odd"><td><p>EXIT_LISTS</p></td>
<td><p>Exit lists (§5.1)</p></td>
</tr>
<tr class="row-even"><td><p>RELAY_DESCRIPTORS</p></td>
<td><p>Relay descriptors (§5.3)</p></td>
</tr>
<tr class="row-odd"><td><p>TORPERF</p></td>
<td><p>Torperf and Onionperf (§5.1)</p></td>
</tr>
<tr class="row-even"><td><p>WEBSTATS</p></td>
<td><p>Web server access logs (§5.4)</p></td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="class">
<dt id="bushel.archive.DirectoryArchive">
<em class="property">class </em><code class="descclassname">bushel.archive.</code><code class="descname">DirectoryArchive</code><span class="sig-paren">(</span><em>archive_path</em>, <em>max_file_concurrency=100</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/bushel/archive.html#DirectoryArchive"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#bushel.archive.DirectoryArchive" title="Permalink to this definition">¶</a></dt>
<dd><p>Persistent filesystem-backed archive for Tor directory protocol
descriptors.</p>
<p>This implements the CollecTor File Structure Protocol as detailed in
<a class="reference internal" href="references.html#collector-protocol" id="id4"><span>[collector-protocol]</span></a>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>archive_path</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><em>str</em></a>) – Either an absolute or relative path to the
location of the directory to use for the archive.
This location must exist, but may be an empty
directory.</p>
</dd>
</dl>
<dl class="method">
<dt id="bushel.archive.DirectoryArchive.bridge_extra_info_descriptor_path">
<code class="descname">bridge_extra_info_descriptor_path</code><span class="sig-paren">(</span><em>published</em>, <em>digest</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/bushel/archive.html#DirectoryArchive.bridge_extra_info_descriptor_path"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#bushel.archive.DirectoryArchive.bridge_extra_info_descriptor_path" title="Permalink to this definition">¶</a></dt>
<dd><p>Generates a path, including the archive path, for a bridge extra-info
descriptor with a given published time and digest. For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">archive</span> <span class="o">=</span> <span class="n">DirectoryArchive</span><span class="p">(</span><span class="s2">&quot;/srv/archive&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">published</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2018</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">19</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">56</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">digest</span> <span class="o">=</span> <span class="s2">&quot;a94a07b201598d847105ae5fcd5bc3ab10124389&quot;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">archive</span><span class="o">.</span><span class="n">bridge_extra_info_descriptor_path</span><span class="p">(</span><span class="n">published</span><span class="p">,</span> <span class="n">digest</span><span class="p">)</span>  <span class="c1"># doctest: +ELLIPSIS</span>
<span class="go">&#39;/srv/archive/bridge-descriptors/extra-info/2018/11/a/9/a94a...389&#39;</span>
</pre></div>
</div>
<p>These paths are defined in §5.2.1 of <a class="reference internal" href="references.html#collector-protocol" id="id5"><span>[collector-protocol]</span></a>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>published</strong> (<a class="reference external" href="https://docs.python.org/3/library/datetime.html#datetime.datetime" title="(in Python v3.7)"><em>datetime</em></a>) – The published time of the
descriptor.</p></li>
<li><p><strong>digest</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><em>str</em></a>) – The hex-encoded SHA-1 digest of the descriptor.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>Archive path as a <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a>.</p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="bushel.archive.DirectoryArchive.bridge_server_descriptor_path">
<code class="descname">bridge_server_descriptor_path</code><span class="sig-paren">(</span><em>published</em>, <em>digest</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/bushel/archive.html#DirectoryArchive.bridge_server_descriptor_path"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#bushel.archive.DirectoryArchive.bridge_server_descriptor_path" title="Permalink to this definition">¶</a></dt>
<dd><p>Generates a path, including the archive path, for a bridge server
descriptor with a given published time and digest. For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">archive</span> <span class="o">=</span> <span class="n">DirectoryArchive</span><span class="p">(</span><span class="s2">&quot;/srv/archive&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">published</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2018</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">19</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">digest</span> <span class="o">=</span> <span class="s2">&quot;a94a07b201598d847105ae5fcd5bc3ab10124389&quot;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">archive</span><span class="o">.</span><span class="n">bridge_server_descriptor_path</span><span class="p">(</span><span class="n">published</span><span class="p">,</span> <span class="n">digest</span><span class="p">)</span>  <span class="c1"># doctest: +ELLIPSIS</span>
<span class="go">&#39;/srv/archive/bridge-descriptors/server-descriptor/2018/11/a/9/a94a...389&#39;</span>
</pre></div>
</div>
<p>These paths are defined in §5.2.1 of <a class="reference internal" href="references.html#collector-protocol" id="id6"><span>[collector-protocol]</span></a>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>published</strong> (<a class="reference external" href="https://docs.python.org/3/library/datetime.html#datetime.datetime" title="(in Python v3.7)"><em>datetime</em></a>) – The published time of the
descriptor.</p></li>
<li><p><strong>digest</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><em>str</em></a>) – The hex-encoded SHA-1 digest of the descriptor.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>Archive path as a <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a>.</p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="bushel.archive.DirectoryArchive.bridge_status_path">
<code class="descname">bridge_status_path</code><span class="sig-paren">(</span><em>valid_after</em>, <em>fingerprint</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/bushel/archive.html#DirectoryArchive.bridge_status_path"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#bushel.archive.DirectoryArchive.bridge_status_path" title="Permalink to this definition">¶</a></dt>
<dd><p>Generates a path, including the archive path, for a bridge status
valid-after time and generated by the authority with the given
fingerprint. For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">archive</span> <span class="o">=</span> <span class="n">DirectoryArchive</span><span class="p">(</span><span class="s2">&quot;/srv/archive&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">valid_after</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2018</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">19</span><span class="p">,</span> <span class="mi">15</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fingerprint</span> <span class="o">=</span> <span class="s2">&quot;BA44A889E64B93FAA2B114E02C2A279A8555C533&quot;</span>  <span class="c1"># Serge</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">archive</span><span class="o">.</span><span class="n">bridge_status_path</span><span class="p">(</span><span class="n">valid_after</span><span class="p">,</span> <span class="n">fingerprint</span><span class="p">)</span>  <span class="c1"># doctest: +ELLIPSIS</span>
<span class="go">&#39;/srv/archive/bridge-descriptors/statuses/2018/11/19/20181119-150000-BA...33&#39;</span>
</pre></div>
</div>
<p>These paths are defined in §5.2.2 of <a class="reference internal" href="references.html#collector-protocol" id="id7"><span>[collector-protocol]</span></a>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>valid_after</strong> (<a class="reference external" href="https://docs.python.org/3/library/datetime.html#datetime.datetime" title="(in Python v3.7)"><em>datetime</em></a>) – The valid-after time for the
status.</p></li>
<li><p><strong>fingerprint</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><em>str</em></a>) – The fingerprint of the bridge authority.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>Path as a <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a>.</p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="bushel.archive.DirectoryArchive.path_for">
<code class="descname">path_for</code><span class="sig-paren">(</span><em>descriptor</em>, <em>create_dir=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/bushel/archive.html#DirectoryArchive.path_for"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#bushel.archive.DirectoryArchive.path_for" title="Permalink to this definition">¶</a></dt>
<dd><p>The filesystem path that a descriptor will be archived at. These paths
are defined in <a class="reference internal" href="references.html#collector-protocol" id="id8"><span>[collector-protocol]</span></a>.</p>
<p>It is also possible to set <em>descriptor</em> with a <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a> in
which case it will be treated as a relative path from the root of the
archive. For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">DirectoryArchive</span><span class="p">(</span><span class="s2">&quot;/srv/archive&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">path_for</span><span class="p">(</span><span class="s2">&quot;path/to/descriptor&quot;</span><span class="p">)</span>
<span class="go">&#39;/srv/archive/path/to/descriptor&#39;</span>
</pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>create_dir</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.7)"><em>bool</em></a>) – Create the directory ready to archive a
descriptor.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>Archive path for the descriptor as a <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a>.</p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="bushel.archive.DirectoryArchive.relay_consensus">
<code class="descname">relay_consensus</code><span class="sig-paren">(</span><em>flavor='ns'</em>, <em>valid_after=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/bushel/archive.html#DirectoryArchive.relay_consensus"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#bushel.archive.DirectoryArchive.relay_consensus" title="Permalink to this definition">¶</a></dt>
<dd><p>Retrieves a consensus from the archive.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>valid_after</strong> (<a class="reference external" href="https://docs.python.org/3/library/datetime.html#datetime.datetime" title="(in Python v3.7)"><em>datetime</em></a>) – If set, will retrieve a consensus with the
given valid_after time, otherwise a vote
that became valid at the top of the
current hour will be retrieved.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A <code class="xref py py-class docutils literal notranslate"><span class="pre">NetworkStatusDocumentV3</span></code>
if found, otherwise <em>None</em>.</p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="bushel.archive.DirectoryArchive.relay_consensus_path">
<code class="descname">relay_consensus_path</code><span class="sig-paren">(</span><em>valid_after</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/bushel/archive.html#DirectoryArchive.relay_consensus_path"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#bushel.archive.DirectoryArchive.relay_consensus_path" title="Permalink to this definition">¶</a></dt>
<dd><p>Generates a path, including the archive path, for a network-status
consensus with a given valid-after time. For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">archive</span> <span class="o">=</span> <span class="n">DirectoryArchive</span><span class="p">(</span><span class="s2">&quot;/srv/archive&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">valid_after</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2018</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">19</span><span class="p">,</span> <span class="mi">15</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">archive</span><span class="o">.</span><span class="n">relay_consensus_path</span><span class="p">(</span><span class="n">valid_after</span><span class="p">)</span>
<span class="go">&#39;/srv/archive/relay-descriptors/consensus/2018/11/19/2018-11-19-15-00-00-consensus&#39;</span>
</pre></div>
</div>
<p>These paths are defined in §5.3.2 of <a class="reference internal" href="references.html#collector-protocol" id="id9"><span>[collector-protocol]</span></a>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>valid_after</strong> (<a class="reference external" href="https://docs.python.org/3/library/datetime.html#datetime.datetime" title="(in Python v3.7)"><em>datetime</em></a>) – The valid-after time for the
status.</p></li>
<li><p><strong>fingerprint</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><em>str</em></a>) – The fingerprint of the bridge authority.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>Path as a <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a>.</p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="bushel.archive.DirectoryArchive.relay_extra_info_descriptor">
<code class="descname">relay_extra_info_descriptor</code><span class="sig-paren">(</span><em>digest</em>, <em>published_hint</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/bushel/archive.html#DirectoryArchive.relay_extra_info_descriptor"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#bushel.archive.DirectoryArchive.relay_extra_info_descriptor" title="Permalink to this definition">¶</a></dt>
<dd><p>Retrieves a relay’s extra-info descriptor from the archive.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>digest</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><em>str</em></a>) – A hex-encoded digest of the descriptor.</p></li>
<li><p><strong>published_hint</strong> (<a class="reference external" href="https://docs.python.org/3/library/datetime.html#datetime.datetime" title="(in Python v3.7)"><em>datetime</em></a>) – Provides a hint on the
published time to allow the descriptor to be found in the archive.
If the descriptor was not published in the same month as this, it
will not be found.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A <a class="reference external" href="https://stem.torproject.org/api/descriptor/extrainfo_descriptor.html#stem.descriptor.extrainfo_descriptor.RelayExtraInfoDescriptor" title="(in Stem v1.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">RelayExtraInfoDescriptor</span></code></a>
if found, otherwise <em>None</em>.</p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="bushel.archive.DirectoryArchive.relay_extra_info_descriptor_path">
<code class="descname">relay_extra_info_descriptor_path</code><span class="sig-paren">(</span><em>published</em>, <em>digest</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/bushel/archive.html#DirectoryArchive.relay_extra_info_descriptor_path"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#bushel.archive.DirectoryArchive.relay_extra_info_descriptor_path" title="Permalink to this definition">¶</a></dt>
<dd><p>Generates a path, including the archive path, for a relay extra-info
descriptor with a given published time and digest. For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">archive</span> <span class="o">=</span> <span class="n">DirectoryArchive</span><span class="p">(</span><span class="s2">&quot;/srv/archive&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">published</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2018</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">19</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">56</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">digest</span> <span class="o">=</span> <span class="s2">&quot;a94a07b201598d847105ae5fcd5bc3ab10124389&quot;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">archive</span><span class="o">.</span><span class="n">relay_extra_info_descriptor_path</span><span class="p">(</span><span class="n">published</span><span class="p">,</span> <span class="n">digest</span><span class="p">)</span>  <span class="c1"># doctest: +ELLIPSIS</span>
<span class="go">&#39;/srv/archive/relay-descriptors/extra-info/2018/11/a/9/a94a...389&#39;</span>
</pre></div>
</div>
<p>These paths are defined in §5.3.2 of <a class="reference internal" href="references.html#collector-protocol" id="id10"><span>[collector-protocol]</span></a>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>published</strong> (<a class="reference external" href="https://docs.python.org/3/library/datetime.html#datetime.datetime" title="(in Python v3.7)"><em>datetime</em></a>) – The published time of the
descriptor.</p></li>
<li><p><strong>digest</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><em>str</em></a>) – The hex-encoded SHA-1 digest of the descriptor.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>Path as a <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a>.</p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="bushel.archive.DirectoryArchive.relay_extra_info_descriptors">
<code class="descname">relay_extra_info_descriptors</code><span class="sig-paren">(</span><em>digests</em>, <em>published_hint</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/bushel/archive.html#DirectoryArchive.relay_extra_info_descriptors"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#bushel.archive.DirectoryArchive.relay_extra_info_descriptors" title="Permalink to this definition">¶</a></dt>
<dd><p>Retrieves multiple extra-info descriptors published around the same time
(e.g. all referenced by server-descriptors in the same consensus).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>digest</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.7)"><em>list</em></a><em>(</em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><em>str</em></a><em>)</em>) – Hex-encoded digests for the descriptors.</p></li>
<li><p><strong>published_hint</strong> (<a class="reference external" href="https://docs.python.org/3/library/datetime.html#datetime.datetime" title="(in Python v3.7)"><em>datetime</em></a>) – Provides a hint on the
published time to allow the descriptor to be found in the archive.
If the descriptor was not published in the same month as this, it
will not be found.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">list</span></code></a> of
<a class="reference external" href="https://stem.torproject.org/api/descriptor/extrainfo_descriptor.html#stem.descriptor.extrainfo_descriptor.RelayExtraInfoDescriptor" title="(in Stem v1.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">stem.descriptor.extrainfo_descriptor.RelayExtraInfoDescriptor</span></code></a>.</p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="bushel.archive.DirectoryArchive.relay_microdescriptor">
<code class="descname">relay_microdescriptor</code><span class="sig-paren">(</span><em>digest</em>, <em>valid_after_hint</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/bushel/archive.html#DirectoryArchive.relay_microdescriptor"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#bushel.archive.DirectoryArchive.relay_microdescriptor" title="Permalink to this definition">¶</a></dt>
<dd><p>Retrieves a relay’s microdescriptor from the archive.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>digest</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><em>str</em></a>) – A hex-encoded digest of the descriptor.</p></li>
<li><p><strong>valid_after_hint</strong> (<a class="reference external" href="https://docs.python.org/3/library/datetime.html#datetime.datetime" title="(in Python v3.7)"><em>datetime</em></a>) – Provides a hint on the
valid_after time to allow the descriptor to be found in the archive.
If the descriptor did not become valid in the same month as this,
it will not be found.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A <a class="reference external" href="https://stem.torproject.org/api/descriptor/microdescriptor.html#stem.descriptor.microdescriptor.Microdescriptor" title="(in Stem v1.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">stem.descriptor.microdescriptor.Microdescriptor</span></code></a>
if found, otherwise <em>None</em>.</p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="bushel.archive.DirectoryArchive.relay_microdescriptors">
<code class="descname">relay_microdescriptors</code><span class="sig-paren">(</span><em>digests</em>, <em>valid_after_hint</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/bushel/archive.html#DirectoryArchive.relay_microdescriptors"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#bushel.archive.DirectoryArchive.relay_microdescriptors" title="Permalink to this definition">¶</a></dt>
<dd><p>Retrieves multiple microdescriptors around the same valid_after time
(e.g. all referenced by the same microdescriptor consensus).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>digest</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.7)"><em>list</em></a><em>(</em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><em>str</em></a><em>)</em>) – Hex-encoded digests for the descriptors.</p></li>
<li><p><strong>valid_after_hint</strong> (<a class="reference external" href="https://docs.python.org/3/library/datetime.html#datetime.datetime" title="(in Python v3.7)"><em>datetime</em></a>) – Provides a hint on the
valid_after time to allow the descriptor to be found in the archive.
If the descriptor did not become valid in the same month as this,
it will not be found.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">list</span></code></a> of
<a class="reference external" href="https://stem.torproject.org/api/descriptor/microdescriptor.html#stem.descriptor.microdescriptor.Microdescriptor" title="(in Stem v1.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">stem.descriptor.microdescriptor.Microdescriptor</span></code></a>.</p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="bushel.archive.DirectoryArchive.relay_server_descriptor">
<code class="descname">relay_server_descriptor</code><span class="sig-paren">(</span><em>digest</em>, <em>published_hint</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/bushel/archive.html#DirectoryArchive.relay_server_descriptor"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#bushel.archive.DirectoryArchive.relay_server_descriptor" title="Permalink to this definition">¶</a></dt>
<dd><p>Retrieves a relay’s server descriptor from the archive.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>digest</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><em>str</em></a>) – A hex-encoded digest of the descriptor.</p></li>
<li><p><strong>published_hint</strong> (<a class="reference external" href="https://docs.python.org/3/library/datetime.html#datetime.datetime" title="(in Python v3.7)"><em>datetime</em></a>) – Provides a hint on the
published time to allow the descriptor to be found in the archive.
If the descriptor was not published in the same month as this, it
will not be found.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A <a class="reference external" href="https://stem.torproject.org/api/descriptor/server_descriptor.html#stem.descriptor.server_descriptor.RelayDescriptor" title="(in Stem v1.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">stem.descriptor.server_descriptor.RelayDescriptor</span></code></a>
if found, otherwise <em>None</em>.</p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="bushel.archive.DirectoryArchive.relay_server_descriptor_path">
<code class="descname">relay_server_descriptor_path</code><span class="sig-paren">(</span><em>published</em>, <em>digest</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/bushel/archive.html#DirectoryArchive.relay_server_descriptor_path"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#bushel.archive.DirectoryArchive.relay_server_descriptor_path" title="Permalink to this definition">¶</a></dt>
<dd><p>Generates a path, including the archive path, for a relay server
descriptor with a given published time and digest. For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">archive</span> <span class="o">=</span> <span class="n">DirectoryArchive</span><span class="p">(</span><span class="s2">&quot;/srv/archive&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">published</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2018</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">19</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">digest</span> <span class="o">=</span> <span class="s2">&quot;a94a07b201598d847105ae5fcd5bc3ab10124389&quot;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">archive</span><span class="o">.</span><span class="n">relay_server_descriptor_path</span><span class="p">(</span><span class="n">published</span><span class="p">,</span> <span class="n">digest</span><span class="p">)</span>  <span class="c1"># doctest: +ELLIPSIS</span>
<span class="go">&#39;/srv/archive/relay-descriptors/server-descriptor/2018/11/a/9/a94a...389&#39;</span>
</pre></div>
</div>
<p>These paths are defined in §5.3.2 of <a class="reference internal" href="references.html#collector-protocol" id="id11"><span>[collector-protocol]</span></a>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>published</strong> (<a class="reference external" href="https://docs.python.org/3/library/datetime.html#datetime.datetime" title="(in Python v3.7)"><em>datetime</em></a>) – The published time of the
descriptor.</p></li>
<li><p><strong>digest</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><em>str</em></a>) – The hex-encoded SHA-1 digest of the descriptor.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>Path as a <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a>.</p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="bushel.archive.DirectoryArchive.relay_server_descriptors">
<code class="descname">relay_server_descriptors</code><span class="sig-paren">(</span><em>digests</em>, <em>published_hint</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/bushel/archive.html#DirectoryArchive.relay_server_descriptors"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#bushel.archive.DirectoryArchive.relay_server_descriptors" title="Permalink to this definition">¶</a></dt>
<dd><p>Retrieves multiple server descriptors published around the same time
(e.g. all referenced by the same consensus).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>digest</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.7)"><em>list</em></a><em>(</em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><em>str</em></a><em>)</em>) – Hex-encoded digests for the descriptors.</p></li>
<li><p><strong>published_hint</strong> (<a class="reference external" href="https://docs.python.org/3/library/datetime.html#datetime.datetime" title="(in Python v3.7)"><em>datetime</em></a>) – Provides a hint on the
published time to allow the descriptor to be found in the archive.
If the descriptor was not published in the same month as this, it
will not be found.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">list</span></code></a> of
<a class="reference external" href="https://stem.torproject.org/api/descriptor/server_descriptor.html#stem.descriptor.server_descriptor.RelayDescriptor" title="(in Stem v1.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">stem.descriptor.server_descriptor.RelayDescriptor</span></code></a>.</p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="bushel.archive.DirectoryArchive.relay_vote">
<code class="descname">relay_vote</code><span class="sig-paren">(</span><em>v3ident</em>, <em>digest='*'</em>, <em>valid_after=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/bushel/archive.html#DirectoryArchive.relay_vote"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#bushel.archive.DirectoryArchive.relay_vote" title="Permalink to this definition">¶</a></dt>
<dd><p>Retrieves a vote from the archive.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>v3ident</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><em>str</em></a>) – The v3ident of the authority that created the vote.</p></li>
<li><p><strong>digest</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><em>str</em></a>) – A hex-encoded digest of the vote. This will
automatically be fixed to upper-case.</p></li>
<li><p><strong>valid_after</strong> (<a class="reference external" href="https://docs.python.org/3/library/datetime.html#datetime.datetime" title="(in Python v3.7)"><em>datetime</em></a>) – If set, will retrieve a
consensus with the given valid_after time, otherwise a vote that
became valid at the top of the current hour will be retrieved.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A <a class="reference external" href="https://stem.torproject.org/api/descriptor/networkstatus.html#stem.descriptor.networkstatus.NetworkStatusDocumentV3" title="(in Stem v1.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">NetworkStatusDocumentV3</span></code></a>
if found, otherwise <em>None</em>.</p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="bushel.archive.DirectoryArchive.relay_vote_path">
<code class="descname">relay_vote_path</code><span class="sig-paren">(</span><em>valid_after</em>, <em>v3ident</em>, <em>digest</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/bushel/archive.html#DirectoryArchive.relay_vote_path"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#bushel.archive.DirectoryArchive.relay_vote_path" title="Permalink to this definition">¶</a></dt>
<dd><p>Generates a path, including the archive path, for a network-status vote
with a given valid-after time, generated by the authority with the
given v3ident, and with the given digest. For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">archive</span> <span class="o">=</span> <span class="n">DirectoryArchive</span><span class="p">(</span><span class="s2">&quot;/srv/archive&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">valid_after</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2018</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">19</span><span class="p">,</span> <span class="mi">15</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">v3ident</span> <span class="o">=</span> <span class="s2">&quot;D586D18309DED4CD6D57C18FDB97EFA96D330566&quot;</span>  <span class="c1"># moria1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">digest</span> <span class="o">=</span> <span class="s2">&quot;663B503182575D242B9D8A67334365FF8ECB53BB&quot;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">archive</span><span class="o">.</span><span class="n">relay_vote_path</span><span class="p">(</span><span class="n">valid_after</span><span class="p">,</span> <span class="n">v3ident</span><span class="p">,</span> <span class="n">digest</span><span class="p">)</span>  <span class="c1"># doctest: +ELLIPSIS</span>
<span class="go">&#39;/srv/archive/relay-descriptors/vote/2018/11/19/2018-11-19-15-00-00-vote-D...-...B&#39;</span>
</pre></div>
</div>
<p>These paths are defined in §5.3.2 of <a class="reference internal" href="references.html#collector-protocol" id="id12"><span>[collector-protocol]</span></a>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>valid_after</strong> (<a class="reference external" href="https://docs.python.org/3/library/datetime.html#datetime.datetime" title="(in Python v3.7)"><em>datetime</em></a>) – The valid-after time.</p></li>
<li><p><strong>v3ident</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><em>str</em></a>) – The v3ident of the directory authority.</p></li>
<li><p><strong>digest</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><em>str</em></a>) – The digest of the vote.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>Path as a <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a>.</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="function">
<dt id="bushel.archive.aglob">
<code class="descclassname">bushel.archive.</code><code class="descname">aglob</code><span class="sig-paren">(</span><em>pathname</em>, <em>*</em>, <em>recursive=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/bushel/archive.html#aglob"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#bushel.archive.aglob" title="Permalink to this definition">¶</a></dt>
<dd><p><a class="reference external" href="https://docs.python.org/3/library/asyncio.html#module-asyncio" title="(in Python v3.7)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">asyncio</span></code></a> wrapper for <a class="reference external" href="https://docs.python.org/3/library/glob.html#glob.glob" title="(in Python v3.7)"><code class="xref py py-func docutils literal notranslate"><span class="pre">glob.glob()</span></code></a>.</p>
</dd></dl>

<dl class="function">
<dt id="bushel.archive.collector_422_filename">
<code class="descclassname">bushel.archive.</code><code class="descname">collector_422_filename</code><span class="sig-paren">(</span><em>valid_after</em>, <em>fingerprint</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/bushel/archive.html#collector_422_filename"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#bushel.archive.collector_422_filename" title="Permalink to this definition">¶</a></dt>
<dd><p>Create a filename for a bridge status according to §4.2.2 of the
<a class="reference internal" href="references.html#collector-protocol" id="id13"><span>[collector-protocol]</span></a>. For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">valid_after</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2018</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">19</span><span class="p">,</span> <span class="mi">15</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fingerprint</span> <span class="o">=</span> <span class="s2">&quot;BA44A889E64B93FAA2B114E02C2A279A8555C533&quot;</span> <span class="c1"># Serge</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">collector_422_filename</span><span class="p">(</span><span class="n">valid_after</span><span class="p">,</span> <span class="n">fingerprint</span><span class="p">)</span>
<span class="go">&#39;20181119-150000-BA44A889E64B93FAA2B114E02C2A279A8555C533&#39;</span>
</pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>valid_after</strong> (<a class="reference external" href="https://docs.python.org/3/library/datetime.html#datetime.datetime" title="(in Python v3.7)"><em>datetime</em></a>) – The valid-after time.</p></li>
<li><p><strong>fingerprint</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><em>str</em></a>) – The fingerprint of the bridge authority.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>Filename as a <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a>.</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="bushel.archive.collector_431_filename">
<code class="descclassname">bushel.archive.</code><code class="descname">collector_431_filename</code><span class="sig-paren">(</span><em>valid_after</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/bushel/archive.html#collector_431_filename"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#bushel.archive.collector_431_filename" title="Permalink to this definition">¶</a></dt>
<dd><p>Create a filename for a network status consensus according to §4.3.1 of the
<a class="reference internal" href="references.html#collector-protocol" id="id14"><span>[collector-protocol]</span></a>. For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">valid_after</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2018</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">19</span><span class="p">,</span> <span class="mi">15</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">collector_431_filename</span><span class="p">(</span><span class="n">valid_after</span><span class="p">)</span>
<span class="go">&#39;2018-11-19-15-00-00-consensus&#39;</span>
</pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>valid_after</strong> (<a class="reference external" href="https://docs.python.org/3/library/datetime.html#datetime.datetime" title="(in Python v3.7)"><em>datetime</em></a>) – The valid-after time.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>Filename as a <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a>.</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="bushel.archive.collector_433_filename">
<code class="descclassname">bushel.archive.</code><code class="descname">collector_433_filename</code><span class="sig-paren">(</span><em>valid_after</em>, <em>v3ident</em>, <em>digest</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/bushel/archive.html#collector_433_filename"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#bushel.archive.collector_433_filename" title="Permalink to this definition">¶</a></dt>
<dd><p>Create a filename for a network status vote according to §4.3.3 of the
<a class="reference internal" href="references.html#collector-protocol" id="id15"><span>[collector-protocol]</span></a>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">valid_after</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2018</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">19</span><span class="p">,</span> <span class="mi">15</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">v3ident</span> <span class="o">=</span> <span class="s2">&quot;D586D18309DED4CD6D57C18FDB97EFA96D330566&quot;</span>  <span class="c1"># moria1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">digest</span> <span class="o">=</span> <span class="s2">&quot;663B503182575D242B9D8A67334365FF8ECB53BB&quot;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">collector_433_filename</span><span class="p">(</span><span class="n">valid_after</span><span class="p">,</span> <span class="n">v3ident</span><span class="p">,</span> <span class="n">digest</span><span class="p">)</span>  <span class="c1"># doctest: +ELLIPSIS</span>
<span class="go">&#39;2018-11-19-15-00-00-vote-D586D18309DED4CD6D57C18FDB97EFA96D330566-663B...3BB&#39;</span>
</pre></div>
</div>
<p>Paths in the Collector File Structure Protocol using this filename expect
<em>upper-case</em> hex-encoded SHA-1 digests.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">v3ident</span> <span class="o">=</span> <span class="s2">&quot;d586d18309ded4cd6d57c18fdb97efa96d330566&quot;</span>  <span class="c1"># Lower case gets corrected</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">digest</span> <span class="o">=</span> <span class="s2">&quot;663b503182575d242b9d8a67334365ff8ecb53bb&quot;</span>  <span class="c1"># Lower case gets corrected</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">collector_433_filename</span><span class="p">(</span><span class="n">valid_after</span><span class="p">,</span> <span class="n">v3ident</span><span class="p">,</span> <span class="n">digest</span><span class="p">)</span>  <span class="c1"># doctest: +ELLIPSIS</span>
<span class="go">&#39;2018-11-19-15-00-00-vote-D586D18309DED4CD6D57C18FDB97EFA96D330566-663B...3BB&#39;</span>
</pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>valid_after</strong> (<a class="reference external" href="https://docs.python.org/3/library/datetime.html#datetime.datetime" title="(in Python v3.7)"><em>datetime</em></a>) – The valid-after time.</p></li>
<li><p><strong>v3ident</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><em>str</em></a>) – The v3ident of the directory authority.</p></li>
<li><p><strong>digest</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><em>str</em></a>) – The digest of the vote.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>Filename as a <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a>.</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="bushel.archive.collector_434_filename">
<code class="descclassname">bushel.archive.</code><code class="descname">collector_434_filename</code><span class="sig-paren">(</span><em>valid_after</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/bushel/archive.html#collector_434_filename"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#bushel.archive.collector_434_filename" title="Permalink to this definition">¶</a></dt>
<dd><p>Create a filename for a microdesc-flavoured network status consensus
according to §4.3.4 of the <a class="reference internal" href="references.html#collector-protocol" id="id16"><span>[collector-protocol]</span></a>. For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">valid_after</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2018</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">19</span><span class="p">,</span> <span class="mi">15</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">collector_434_filename</span><span class="p">(</span><span class="n">valid_after</span><span class="p">)</span>
<span class="go">&#39;2018-11-19-15-00-00-consensus-microdesc&#39;</span>
</pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>valid_after</strong> (<a class="reference external" href="https://docs.python.org/3/library/datetime.html#datetime.datetime" title="(in Python v3.7)"><em>datetime</em></a>) – The valid-after time.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>Filename as a <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a>.</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="bushel.archive.collector_521_path">
<code class="descclassname">bushel.archive.</code><code class="descname">collector_521_path</code><span class="sig-paren">(</span><em>subdirectory</em>, <em>marker</em>, <em>published</em>, <em>digest</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/bushel/archive.html#collector_521_path"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#bushel.archive.collector_521_path" title="Permalink to this definition">¶</a></dt>
<dd><p>Create a path according to §5.2.1 of the <a class="reference internal" href="references.html#collector-protocol" id="id17"><span>[collector-protocol]</span></a>. This is
used for server-descriptors and extra-info descriptors for both relays and
bridges. For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">subdirectory</span> <span class="o">=</span> <span class="n">CollectorOutSubdirectory</span><span class="o">.</span><span class="n">RELAY_DESCRIPTORS</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">marker</span> <span class="o">=</span> <span class="n">CollectorOutRelayDescsMarker</span><span class="o">.</span><span class="n">SERVER_DESCRIPTOR</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">published</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2018</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">19</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">56</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">digest</span> <span class="o">=</span> <span class="s2">&quot;a94a07b201598d847105ae5fcd5bc3ab10124389&quot;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">collector_521_path</span><span class="p">(</span><span class="n">subdirectory</span><span class="p">,</span> <span class="n">marker</span><span class="p">,</span> <span class="n">published</span><span class="p">,</span> <span class="n">digest</span><span class="p">)</span>  <span class="c1"># doctest: +ELLIPSIS</span>
<span class="go">&#39;relay-descriptors/server-descriptor/2018/11/a/9/a94a...389&#39;</span>
</pre></div>
</div>
<p>Paths in the Collector File Structure Protocol using this substructure
expect <em>lower-case</em> hex-encoded SHA-1 digests.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">digest</span> <span class="o">=</span> <span class="s2">&quot;A94A07B201598D847105AE5FCD5BC3AB10124389&quot;</span> <span class="c1"># Upper case gets corrected</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">collector_521_path</span><span class="p">(</span><span class="n">subdirectory</span><span class="p">,</span> <span class="n">marker</span><span class="p">,</span> <span class="n">published</span><span class="p">,</span> <span class="n">digest</span><span class="p">)</span>  <span class="c1"># doctest: +ELLIPSIS</span>
<span class="go">&#39;relay-descriptors/server-descriptor/2018/11/a/9/a94a...389&#39;</span>
</pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>subdirectory</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><em>str</em></a>) – The subdirectory under the “out” directory to
use. Standard values can be found in
<a class="reference internal" href="#bushel.archive.CollectorOutSubdirectory" title="bushel.archive.CollectorOutSubdirectory"><code class="xref py py-data docutils literal notranslate"><span class="pre">CollectorOutSubdirectory</span></code></a>.</p></li>
<li><p><strong>marker</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><em>str</em></a>) – The marker under the subdirectory to use. Standard values
can be found in <a class="reference internal" href="#bushel.archive.CollectorOutRelayDescsMarker" title="bushel.archive.CollectorOutRelayDescsMarker"><code class="xref py py-data docutils literal notranslate"><span class="pre">CollectorOutRelayDescsMarker</span></code></a>
and <a class="reference internal" href="#bushel.archive.CollectorOutBridgeDescsMarker" title="bushel.archive.CollectorOutBridgeDescsMarker"><code class="xref py py-data docutils literal notranslate"><span class="pre">CollectorOutBridgeDescsMarker</span></code></a>.</p></li>
<li><p><strong>published</strong> (<a class="reference external" href="https://docs.python.org/3/library/datetime.html#datetime.datetime" title="(in Python v3.7)"><em>datetime</em></a>) – The published time.</p></li>
<li><p><strong>digest</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><em>str</em></a>) – The hex-encoded SHA-1 digest for the descriptor. The
case will automatically be fixed to lower-case.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>Path for the descriptor as a <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a>.</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="bushel.archive.collector_521_substructure">
<code class="descclassname">bushel.archive.</code><code class="descname">collector_521_substructure</code><span class="sig-paren">(</span><em>published</em>, <em>digest</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/bushel/archive.html#collector_521_substructure"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#bushel.archive.collector_521_substructure" title="Permalink to this definition">¶</a></dt>
<dd><p>Create a path substructure according to §5.2.1 of the
<a class="reference internal" href="references.html#collector-protocol" id="id18"><span>[collector-protocol]</span></a>. This is used for server-descriptors and extra-info
descriptors for both relays and bridges. For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">published</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2018</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">19</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">56</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">digest</span> <span class="o">=</span> <span class="s2">&quot;a94a07b201598d847105ae5fcd5bc3ab10124389&quot;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">collector_521_substructure</span><span class="p">(</span><span class="n">published</span><span class="p">,</span> <span class="n">digest</span><span class="p">)</span>
<span class="go">&#39;2018/11/a/9&#39;</span>
</pre></div>
</div>
<p>Paths in the Collector File Structure Protocol using this substructure
expect <em>lower-case</em> hex-encoded SHA-1 digests.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">digest</span> <span class="o">=</span> <span class="s2">&quot;A94A07B201598D847105AE5FCD5BC3AB10124389&quot;</span> <span class="c1"># Upper case gets corrected</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">collector_521_substructure</span><span class="p">(</span><span class="n">published</span><span class="p">,</span> <span class="n">digest</span><span class="p">)</span>
<span class="go">&#39;2018/11/a/9&#39;</span>
</pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>published</strong> (<a class="reference external" href="https://docs.python.org/3/library/datetime.html#datetime.datetime" title="(in Python v3.7)"><em>datetime</em></a>) – The published time.</p></li>
<li><p><strong>digest</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><em>str</em></a>) – The hex-encoded SHA-1 digest for the descriptor. The
case will automatically be fixed to lower-case.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>Path substructure as a <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a>.</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="bushel.archive.collector_522_path">
<code class="descclassname">bushel.archive.</code><code class="descname">collector_522_path</code><span class="sig-paren">(</span><em>subdirectory</em>, <em>marker</em>, <em>valid_after</em>, <em>filename</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/bushel/archive.html#collector_522_path"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#bushel.archive.collector_522_path" title="Permalink to this definition">¶</a></dt>
<dd><p>Create a path according to §5.2.2 of the <a class="reference internal" href="references.html#collector-protocol" id="id19"><span>[collector-protocol]</span></a>. This is
used for bridge statuses, and network-status consensuses (both ns- and
microdesc- flavors) and votes. For a bridge status for example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">subdirectory</span> <span class="o">=</span> <span class="n">CollectorOutSubdirectory</span><span class="o">.</span><span class="n">BRIDGE_DESCRIPTORS</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">marker</span> <span class="o">=</span> <span class="n">CollectorOutBridgeDescsMarker</span><span class="o">.</span><span class="n">STATUSES</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">valid_after</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2018</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">19</span><span class="p">,</span> <span class="mi">15</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fingerprint</span> <span class="o">=</span> <span class="s2">&quot;BA44A889E64B93FAA2B114E02C2A279A8555C533&quot;</span> <span class="c1"># Serge</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">filename</span> <span class="o">=</span> <span class="n">collector_422_filename</span><span class="p">(</span><span class="n">valid_after</span><span class="p">,</span> <span class="n">fingerprint</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">collector_522_path</span><span class="p">(</span><span class="n">subdirectory</span><span class="p">,</span> <span class="n">marker</span><span class="p">,</span> <span class="n">valid_after</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>  <span class="c1"># doctest: +ELLIPSIS</span>
<span class="go">&#39;bridge-descriptors/statuses/2018/11/19/20181119-150000-BA44...533&#39;</span>
</pre></div>
</div>
<p>Or alternatively for a network-status consensus:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">subdirectory</span> <span class="o">=</span> <span class="n">CollectorOutSubdirectory</span><span class="o">.</span><span class="n">RELAY_DESCRIPTORS</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">marker</span> <span class="o">=</span> <span class="n">CollectorOutRelayDescsMarker</span><span class="o">.</span><span class="n">CONSENSUS</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">valid_after</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2018</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">19</span><span class="p">,</span> <span class="mi">15</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">filename</span> <span class="o">=</span> <span class="n">collector_431_filename</span><span class="p">(</span><span class="n">valid_after</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">collector_522_path</span><span class="p">(</span><span class="n">subdirectory</span><span class="p">,</span> <span class="n">marker</span><span class="p">,</span> <span class="n">valid_after</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
<span class="go">&#39;relay-descriptors/consensus/2018/11/19/2018-11-19-15-00-00-consensus&#39;</span>
</pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>subdirectory</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><em>str</em></a>) – The subdirectory under the “out” directory to
use. Standard values can be found in
<a class="reference internal" href="#bushel.archive.CollectorOutSubdirectory" title="bushel.archive.CollectorOutSubdirectory"><code class="xref py py-data docutils literal notranslate"><span class="pre">CollectorOutSubdirectory</span></code></a>.</p></li>
<li><p><strong>marker</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><em>str</em></a>) – The marker under the subdirectory to use. Standard values
can be found in <a class="reference internal" href="#bushel.archive.CollectorOutRelayDescsMarker" title="bushel.archive.CollectorOutRelayDescsMarker"><code class="xref py py-data docutils literal notranslate"><span class="pre">CollectorOutRelayDescsMarker</span></code></a>
and <a class="reference internal" href="#bushel.archive.CollectorOutBridgeDescsMarker" title="bushel.archive.CollectorOutBridgeDescsMarker"><code class="xref py py-data docutils literal notranslate"><span class="pre">CollectorOutBridgeDescsMarker</span></code></a>.</p></li>
<li><p><strong>valid_after</strong> (<a class="reference external" href="https://docs.python.org/3/library/datetime.html#datetime.datetime" title="(in Python v3.7)"><em>datetime</em></a>) – The valid_after time.</p></li>
<li><p><strong>filename</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><em>str</em></a>) – The filename to use as a <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a>, typically
created with <a class="reference internal" href="#bushel.archive.collector_422_filename" title="bushel.archive.collector_422_filename"><code class="xref py py-func docutils literal notranslate"><span class="pre">collector_422_filename()</span></code></a> for
bridge statuses, <a class="reference internal" href="#bushel.archive.collector_431_filename" title="bushel.archive.collector_431_filename"><code class="xref py py-func docutils literal notranslate"><span class="pre">collector_431_filename()</span></code></a> for
network-status consensuses, or
<a class="reference internal" href="#bushel.archive.collector_433_filename" title="bushel.archive.collector_433_filename"><code class="xref py py-func docutils literal notranslate"><span class="pre">collector_433_filename()</span></code></a> for network-status
votes.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>Path for the descriptor as a <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a>.</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="bushel.archive.collector_522_substructure">
<code class="descclassname">bushel.archive.</code><code class="descname">collector_522_substructure</code><span class="sig-paren">(</span><em>valid_after</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/bushel/archive.html#collector_522_substructure"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#bushel.archive.collector_522_substructure" title="Permalink to this definition">¶</a></dt>
<dd><p>Create a path substructure according to §5.2.2 of the
<a class="reference internal" href="references.html#collector-protocol" id="id20"><span>[collector-protocol]</span></a>. This is used for bridge statuses, and network-status
consensuses and votes. For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">valid_after</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2018</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">19</span><span class="p">,</span> <span class="mi">15</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">collector_522_substructure</span><span class="p">(</span><span class="n">valid_after</span><span class="p">)</span>
<span class="go">&#39;2018/11/19&#39;</span>
</pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>valid_after</strong> (<a class="reference external" href="https://docs.python.org/3/library/datetime.html#datetime.datetime" title="(in Python v3.7)"><em>datetime</em></a>) – The valid-after time.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>Path substructure as a <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a>.</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="bushel.archive.collector_533_substructure">
<code class="descclassname">bushel.archive.</code><code class="descname">collector_533_substructure</code><span class="sig-paren">(</span><em>valid_after</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/bushel/archive.html#collector_533_substructure"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#bushel.archive.collector_533_substructure" title="Permalink to this definition">¶</a></dt>
<dd><p>Create a substructure according to §5.3.3 of the <a class="reference internal" href="references.html#collector-protocol" id="id21"><span>[collector-protocol]</span></a>.
This is used for microdesc-flavored consensuses and microdescriptors. For
example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">valid_after</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2018</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">19</span><span class="p">,</span> <span class="mi">15</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">collector_533_substructure</span><span class="p">(</span><span class="n">valid_after</span><span class="p">)</span>
<span class="go">&#39;2018/11&#39;</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="bushel.archive.collector_534_consensus_path">
<code class="descclassname">bushel.archive.</code><code class="descname">collector_534_consensus_path</code><span class="sig-paren">(</span><em>valid_after</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/bushel/archive.html#collector_534_consensus_path"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#bushel.archive.collector_534_consensus_path" title="Permalink to this definition">¶</a></dt>
<dd><p>Create a path according to §5.3.4 of the <a class="reference internal" href="references.html#collector-protocol" id="id22"><span>[collector-protocol]</span></a> for a
<strong>microdesc-flavored</strong> consensus. For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">valid_after</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2018</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">19</span><span class="p">,</span> <span class="mi">15</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">collector_534_consensus_path</span><span class="p">(</span><span class="n">valid_after</span><span class="p">)</span>
<span class="go">&#39;relay-descriptors/microdesc/2018/11/consensus-microdesc/19/2018-11-19-15-00-00-consensus-microdesc&#39;</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="bushel.archive.collector_534_microdescriptor_path">
<code class="descclassname">bushel.archive.</code><code class="descname">collector_534_microdescriptor_path</code><span class="sig-paren">(</span><em>valid_after</em>, <em>digest</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/bushel/archive.html#collector_534_microdescriptor_path"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#bushel.archive.collector_534_microdescriptor_path" title="Permalink to this definition">¶</a></dt>
<dd><p>Create a path according to §5.3.4 of the <a class="reference internal" href="references.html#collector-protocol" id="id23"><span>[collector-protocol]</span></a> for a
microdescriptor. For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">valid_after</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2018</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">19</span><span class="p">,</span> <span class="mi">15</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">digest</span> <span class="o">=</span> <span class="s2">&quot;00d91cf96321fbd536dd07e297a5e1b7e6961ddd10facdd719716e351453168f&quot;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">collector_534_microdescriptor_path</span><span class="p">(</span><span class="n">valid_after</span><span class="p">,</span> <span class="n">digest</span><span class="p">)</span>
<span class="go">&#39;relay-descriptors/microdesc/2018/11/micro/0/0/00d91cf96321fbd536dd07e297a5e1b7e6961ddd10facdd719716e351453168f&#39;</span>
</pre></div>
</div>
<p>This path in the Collector File Structure Protocol using this substructure
expect <em>lower-case</em> hex-encoded SHA-256 digests.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">valid_after</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2018</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">19</span><span class="p">,</span> <span class="mi">15</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">digest</span> <span class="o">=</span> <span class="s2">&quot;00D91CF96321FBD536DD07E297A5E1B7E6961DDD10FACDD719716E351453168F&quot;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">collector_534_microdescriptor_path</span><span class="p">(</span><span class="n">valid_after</span><span class="p">,</span> <span class="n">digest</span><span class="p">)</span>
<span class="go">&#39;relay-descriptors/microdesc/2018/11/micro/0/0/00d91cf96321fbd536dd07e297a5e1b7e6961ddd10facdd719716e351453168f&#39;</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="bushel.archive.parse_file">
<code class="descclassname">bushel.archive.</code><code class="descname">parse_file</code><span class="sig-paren">(</span><em>path</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/bushel/archive.html#parse_file"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#bushel.archive.parse_file" title="Permalink to this definition">¶</a></dt>
<dd><p>Parses a descriptor from a file.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>str/bytes</strong> (<em>content</em>) – String to construct the descriptor from</p></li>
<li><p><strong>dict</strong> (<em>kwargs</em>) – Additional arguments for
<code class="xref py py-meth docutils literal notranslate"><span class="pre">stem.descriptor.Descriptor.parse_file()</span></code>.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">stem.descriptor.Descriptor</span></code> subclass for the given
content, or a <em>list</em> of descriptors if <strong>multiple=True</strong> is
provided.</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="bushel.archive.prepare_annotated_content">
<code class="descclassname">bushel.archive.</code><code class="descname">prepare_annotated_content</code><span class="sig-paren">(</span><em>descriptor</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/bushel/archive.html#prepare_annotated_content"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#bushel.archive.prepare_annotated_content" title="Permalink to this definition">¶</a></dt>
<dd><p>Encodes annotations and prepends them to the descriptor bytes for writing
to disk.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>descriptor</strong> (<em>Descriptor</em>) – The descriptor to prepare.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#bytes" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">bytes</span></code></a> for the annotated descriptor.</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="bushel.archive.valid_after_now">
<code class="descclassname">bushel.archive.</code><code class="descname">valid_after_now</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/bushel/archive.html#valid_after_now"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#bushel.archive.valid_after_now" title="Permalink to this definition">¶</a></dt>
<dd><p>Takes a good guess at the valid-after time of the latest consensus. There
is an assumption that there is a new consensus every hour and that it is
valid from the top of the hour. Different valid-after times are compliant
with <a class="reference internal" href="references.html#dir-spec" id="id24"><span>[dir-spec]</span></a> however, and so this may be wrong.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>A <a class="reference external" href="https://docs.python.org/3/library/datetime.html#datetime.datetime" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">datetime</span></code></a> for the top of the hour.</p>
</dd>
</dl>
</dd></dl>

</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">bushel</a></h1>








<h3>Navigation</h3>
<p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Directory Archive</a></li>
<li class="toctree-l1"><a class="reference internal" href="bandwidth.html">Bandwidth Scanner</a></li>
<li class="toctree-l1"><a class="reference internal" href="collector.html">CollecTor</a></li>
<li class="toctree-l1"><a class="reference internal" href="directory.html">Tor Directory Protocol</a></li>
<li class="toctree-l1"><a class="reference internal" href="downloader.html">Directory Downloader</a></li>
<li class="toctree-l1"><a class="reference internal" href="monitoring.html">Monitoring</a></li>
<li class="toctree-l1"><a class="reference internal" href="plugins.html">Plugin API</a></li>
<li class="toctree-l1"><a class="reference internal" href="references.html">References</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="index.html" title="previous chapter">Welcome to bushel’s documentation!</a></li>
      <li>Next: <a href="bandwidth.html" title="next chapter">Bandwidth Scanner</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2018, Tor Project.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 2.0.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="_sources/archive.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>